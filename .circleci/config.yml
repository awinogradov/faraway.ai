version: 2
jobs:
  functions:
    working_directory: ~/faraway.ai
    docker:
      - image: circleci/node:10.16.3
    steps:
      - checkout

      - run:
          name: common
          command: npm ci

      - run:
          name: bootstrap
          command: npm i --prefix=projects/functions

      - run:
          name: test
          command: npm test --prefix=projects/functions

      - store_artifacts: # special step to save test results as as artifact
          # Upload test summary for display in Artifacts: https://circleci.com/docs/2.0/artifacts/
          path: test-results.xml
          prefix: tests

      - store_test_results: # for display in Test Summary: https://circleci.com/docs/2.0/collect-test-data/
          path: test-results.xml

      # See https://circleci.com/docs/2.0/deployment-integrations/ for deploy examples

workflows:
  version: 2
  functions:
    jobs:
      - functions

      # - run: # run coverage report
      #     name: code-coverage
      #     command: './node_modules/.bin/nyc report --reporter=text-lcov'
      # - store_artifacts: # for display in Artifacts: https://circleci.com/docs/2.0/artifacts/
      #     path: coverage
      #     prefix: coverage
